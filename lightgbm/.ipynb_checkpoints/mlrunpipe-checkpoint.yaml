"apiVersion": |-
  argoproj.io/v1alpha1
"kind": |-
  Workflow
"metadata":
  "annotations":
    "pipelines.kubeflow.org/pipeline_spec": |-
      {"description": "Shows how to use mlrun.", "inputs": [{"default": "[0.1, 0.2]", "name": "learning_rate"}, {"default": "[30, 31]", "name": "num_leaves"}], "name": "LGBMClassifier training pipeline"}
  "generateName": |-
    lgbmclassifier-training-pipeline-
"spec":
  "arguments":
    "parameters":
    - "name": |-
        learning_rate
      "value": |-
        [0.1, 0.2]
    - "name": |-
        num_leaves
      "value": |-
        [30, 31]
  "entrypoint": |-
    lgbmclassifier-training-pipeline
  "serviceAccountName": |-
    pipeline-runner
  "templates":
  - "container":
      "command":
      - |-
        python
      - |-
        -m
      - |-
        mlrun
      - |-
        deploy
      - |-
        {'kind': 'remote', 'metadata': {'name': 'higgs-serving'}, 'spec': {'command': '', 'args': [], 'image': '', 'mode': '', 'description': '', 'volumes': [{'volume': {'flexVolume': {'driver': 'v3io/fuse', 'options': {'accessKey': '4a5eabdc-0814-489e-9fdf-6ad2fa5df31d', 'container': 'users', 'subPath': '/admin'}}, 'name': 'fs'}, 'volumeMount': {'name': 'fs', 'mountPath': 'User'}}], 'env': {'TRANSPORT_PROTOCOL': 'seldon', 'ENABLE_EXPLAINER': 'False', 'MODEL_CLASS': 'LGBoostModel', 'V3IO_FRAMESD': 'framesd.default-tenant.svc:8080', 'V3IO_USERNAME': 'admin', 'V3IO_ACCESS_KEY': '4a5eabdc-0814-489e-9fdf-6ad2fa5df31d', 'V3IO_API': 'v3io-webapi.default-tenant.svc:8081'}, 'config': {'spec.triggers.http': {'kind': 'http', 'maxWorkers': 8, 'attributes': {'ingresses': {}}, 'annotations': {}}}, 'build_commands': [], 'base_spec': {'apiVersion': 'nuclio.io/v1', 'kind': 'Function', 'metadata': {'annotations': {'nuclio.io/generated_by': 'function generated at 11-12-2019 by admin from step-1-model-serving.ipynb'}, 'labels': {}, 'name': 'step-1-model-serving'}, 'spec': {'build': {'commands': ['pip install kfserving==0.2.0 --upgrade', 'pip install azure', 'pip install numpy', 'pip install lightgbm'], 'functionSourceCode': 'IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlciBvbiAyMDE5LTEyLTExIDE0OjM0CgppbXBvcnQga2ZzZXJ2aW5nCmltcG9ydCBvcwppbXBvcnQgbnVtcHkgYXMgbnAKZnJvbSB0eXBpbmcgaW1wb3J0IExpc3QKaW1wb3J0IGxpZ2h0Z2JtIGFzIGxnYgoKQk9PU1RFUl9GSUxFID0gIm1vZGVsLnR4dCIKCmNsYXNzIExHQm9vc3RNb2RlbChrZnNlcnZpbmcuS0ZNb2RlbCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgbmFtZTogc3RyLCBtb2RlbF9kaXI6IHN0ciwgYm9vc3RlcjogbGdiLkxHQk1Nb2RlbCA9IE5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18obmFtZSkKICAgICAgICBzZWxmLm5hbWUgPSBuYW1lCiAgICAgICAgc2VsZi5tb2RlbF9kaXIgPSBtb2RlbF9kaXIKICAgICAgICBpZiBub3QgYm9vc3RlciBpcyBOb25lOgogICAgICAgICAgICBzZWxmLl9ib29zdGVyID0gYm9vc3RlcgogICAgICAgICAgICBzZWxmLnJlYWR5ID0gVHJ1ZQoKICAgIGRlZiBsb2FkKHNlbGYpOgogICAgICAgIG1vZGVsX2ZpbGUgPSBvcy5wYXRoLmpvaW4oCiAgICAgICAgICAgIGtmc2VydmluZy5TdG9yYWdlLmRvd25sb2FkKHNlbGYubW9kZWxfZGlyKSwgQk9PU1RFUl9GSUxFKQogICAgICAgIHNlbGYuX2Jvb3N0ZXIgPSBsZ2IuQm9vc3Rlcihtb2RlbF9maWxlPW1vZGVsX2ZpbGUpCiAgICAgICAgc2VsZi5yZWFkeSA9IFRydWUKCiAgICBkZWYgcHJlZGljdChzZWxmLCBib2R5OiBMaXN0KSAtPiBMaXN0OgogICAgICAgIHRyeToKICAgICAgICAgICAgZG1hdHJpeCA9IG5wLmFzYXJyYXkoYm9keSkKICAgICAgICAgICAgcmVzdWx0OiBucC5uZGFycmF5ID0gc2VsZi5fYm9vc3Rlci5wcmVkaWN0KGRtYXRyaXgpCiAgICAgICAgICAgIHJldHVybiByZXN1bHQudG9saXN0KCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbihmIkZhaWxlZCB0byBwcmVkaWN0IHtlfSIpCgoKCmltcG9ydCBqc29uCmltcG9ydCBvcwppbXBvcnQgbnVtcHkgYXMgbnAKZnJvbSB0eXBpbmcgaW1wb3J0IExpc3QKZnJvbSBodHRwIGltcG9ydCBIVFRQU3RhdHVzCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0CmZyb20ga2ZzZXJ2aW5nLnByb3RvY29scy5yZXF1ZXN0X2hhbmRsZXIgaW1wb3J0IFwKICAgIFJlcXVlc3RIYW5kbGVyICAjIHB5bGludDogZGlzYWJsZT1uby1uYW1lLWluLW1vZHVsZQpmcm9tIGVudW0gaW1wb3J0IEVudW0KCiMjIyMjIyMjIyMjIwojIEVuY29kZXJzICMKIyMjIyMjIyMjIyMjCgpjbGFzcyBOdW1weUVuY29kZXIoanNvbi5KU09ORW5jb2Rlcik6CiAgICBkZWYgZGVmYXVsdChzZWxmLCBvYmopOiAgIyBweWxpbnQ6IGRpc2FibGU9YXJndW1lbnRzLWRpZmZlcixtZXRob2QtaGlkZGVuCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosICgKICAgICAgICAgICAgICAgIG5wLmludF8sIG5wLmludGMsIG5wLmludHAsIG5wLmludDgsIG5wLmludDE2LCBucC5pbnQzMiwKICAgICAgICAgICAgICAgIG5wLmludDY0LCBucC51aW50OCwKICAgICAgICAgICAgICAgIG5wLnVpbnQxNiwgbnAudWludDMyLCBucC51aW50NjQpKToKICAgICAgICAgICAgcmV0dXJuIGludChvYmopCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKG9iaiwgKG5wLmZsb2F0XywgbnAuZmxvYXQxNiwgbnAuZmxvYXQzMiwgbnAuZmxvYXQ2NCkpOgogICAgICAgICAgICByZXR1cm4gZmxvYXQob2JqKQogICAgICAgIGVsaWYgaXNpbnN0YW5jZShvYmosIChucC5uZGFycmF5LCkpOgogICAgICAgICAgICByZXR1cm4gb2JqLnRvbGlzdCgpCiAgICAgICAgcmV0dXJuIGpzb24uSlNPTkVuY29kZXIuZGVmYXVsdChzZWxmLCBvYmopCgpjbGFzcyBTZWxkb25QYXlsb2FkKEVudW0pOgogICAgVEVOU09SID0gMQogICAgTkRBUlJBWSA9IDIKICAgIFRGVEVOU09SID0gMwoKZGVmIF9leHRyYWN0X2xpc3QoYm9keTogRGljdCkgLT4gTGlzdDoKICAgIGRhdGFfZGVmID0gYm9keVsiZGF0YSJdCiAgICBpZiAidGVuc29yIiBpbiBkYXRhX2RlZjoKICAgICAgICBhcnIgPSBucC5hcnJheShkYXRhX2RlZi5nZXQoInRlbnNvciIpLmdldCgidmFsdWVzIikpLnJlc2hhcGUoCiAgICAgICAgICAgIGRhdGFfZGVmLmdldCgidGVuc29yIikuZ2V0KCJzaGFwZSIpKQogICAgICAgIHJldHVybiBhcnIudG9saXN0KCkKICAgIGVsaWYgIm5kYXJyYXkiIGluIGRhdGFfZGVmOgogICAgICAgIHJldHVybiBkYXRhX2RlZi5nZXQoIm5kYXJyYXkiKQogICAgZWxzZToKICAgICAgICByYWlzZSBFeGNlcHRpb24oIkNvdWxkIG5vdCBleHRyYWN0IHNlbGRvbiBwYXlsb2FkICVzIiAlIGJvZHkpCgoKZGVmIF9jcmVhdGVfc2VsZG9uX2RhdGFfZGVmKGFycmF5OiBucC5hcnJheSwgdHk6IFNlbGRvblBheWxvYWQpOgogICAgZGF0YWRlZiA9IHt9CiAgICBpZiB0eSA9PSBTZWxkb25QYXlsb2FkLlRFTlNPUjoKICAgICAgICBkYXRhZGVmWyJ0ZW5zb3IiXSA9IHsKICAgICAgICAgICAgInNoYXBlIjogYXJyYXkuc2hhcGUsCiAgICAgICAgICAgICJ2YWx1ZXMiOiBhcnJheS5yYXZlbCgpLnRvbGlzdCgpCiAgICAgICAgfQogICAgZWxpZiB0eSA9PSBTZWxkb25QYXlsb2FkLk5EQVJSQVk6CiAgICAgICAgZGF0YWRlZlsibmRhcnJheSJdID0gYXJyYXkudG9saXN0KCkKICAgIGVsaWYgdHkgPT0gU2VsZG9uUGF5bG9hZC5URlRFTlNPUjoKICAgICAgICByYWlzZSBOb3RJbXBsZW1lbnRlZEVycm9yKCJTZWxkb24gcGF5bG9hZCAlcyBub3Qgc3VwcG9ydGVkIiAlIHR5KQogICAgZWxzZToKICAgICAgICByYWlzZSBFeGNlcHRpb24oIlVua25vd24gU2VsZG9uIHBheWxvYWQgJXMiICUgdHkpCiAgICByZXR1cm4gZGF0YWRlZgoKCmRlZiBfZ2V0X3JlcXVlc3RfdHkoCiAgICAgICAgcmVxdWVzdDogRGljdCkgLT4gXAogICAgICAgIFNlbGRvblBheWxvYWQ6ICAjIHB5bGludDogZGlzYWJsZT1pbmNvbnNpc3RlbnQtcmV0dXJuLXN0YXRlbWVudHMKICAgIGRhdGFfZGVmID0gcmVxdWVzdFsiZGF0YSJdCiAgICBpZiAidGVuc29yIiBpbiBkYXRhX2RlZjoKICAgICAgICByZXR1cm4gU2VsZG9uUGF5bG9hZC5URU5TT1IKICAgIGVsaWYgIm5kYXJyYXkiIGluIGRhdGFfZGVmOgogICAgICAgIHJldHVybiBTZWxkb25QYXlsb2FkLk5EQVJSQVkKICAgIGVsaWYgInRmdGVuc29yIiBpbiBkYXRhX2RlZjoKICAgICAgICByZXR1cm4gU2VsZG9uUGF5bG9hZC5URlRFTlNPUgoKCmRlZiBjcmVhdGVfcmVxdWVzdChhcnI6IG5wLm5kYXJyYXksIHR5OiBTZWxkb25QYXlsb2FkKSAtPiBEaWN0OgogICAgc2VsZG9uX2RhdGFkZWYgPSBfY3JlYXRlX3NlbGRvbl9kYXRhX2RlZihhcnIsIHR5KQogICAgcmV0dXJuIHsiZGF0YSI6IHNlbGRvbl9kYXRhZGVmfQoKCmNsYXNzIFNlbGRvblJlcXVlc3RIYW5kbGVyKFJlcXVlc3RIYW5kbGVyKToKCiAgICBkZWYgX19pbml0X18oc2VsZiwgY29udGV4dCwKICAgICAgICAgICAgICAgICByZXF1ZXN0OiBEaWN0KTogICMgcHlsaW50OiBkaXNhYmxlPXVzZWxlc3Mtc3VwZXItZGVsZWdhdGlvbgogICAgICAgIHN1cGVyKCkuX19pbml0X18ocmVxdWVzdCkKICAgICAgICBzZWxmLmNvbnRleHQgPSBjb250ZXh0CgogICAgZGVmIHZhbGlkYXRlKHNlbGYpOgogICAgICAgIGlmIG5vdCAiZGF0YSIgaW4gc2VsZi5yZXF1ZXN0OgogICAgICAgICAgICByZXR1cm4gc2VsZi5jb250ZXh0LlJlc3BvbnNlKAogICAgICAgICAgICAgICAgYm9keT0iRXhwZWN0ZWQga2V5IFwiZGF0YVwiIGluIHJlcXVlc3QgYm9keSIsCiAgICAgICAgICAgICAgICBoZWFkZXJzPXt9LAogICAgICAgICAgICAgICAgY29udGVudF90eXBlPSd0ZXh0L3BsYWluJywKICAgICAgICAgICAgICAgIHN0YXR1c19jb2RlPTUwMCkKICAgICAgICB0eSA9IF9nZXRfcmVxdWVzdF90eShzZWxmLnJlcXVlc3QpCiAgICAgICAgaWYgbm90ICh0eSA9PSBTZWxkb25QYXlsb2FkLlRFTlNPUiBvciB0eSA9PSBTZWxkb25QYXlsb2FkLk5EQVJSQVkpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5jb250ZXh0LlJlc3BvbnNlKAogICAgICAgICAgICAgICAgYm9keT0iXCJkYXRhXCIga2V5IHNob3VsZCBjb250YWluIGVpdGhlciBcInRlbnNvclwiLCIKICAgICAgICAgICAgICAgICAgICAgIlwibmRhcnJheVwiIiwKICAgICAgICAgICAgICAgIGhlYWRlcnM9e30sCiAgICAgICAgICAgICAgICBjb250ZW50X3R5cGU9J3RleHQvcGxhaW4nLAogICAgICAgICAgICAgICAgc3RhdHVzX2NvZGU9NTAwKQoKICAgIGRlZiBleHRyYWN0X3JlcXVlc3Qoc2VsZikgLT4gTGlzdDoKICAgICAgICByZXR1cm4gX2V4dHJhY3RfbGlzdChzZWxmLnJlcXVlc3QpCgogICAgZGVmIHdyYXBfcmVzcG9uc2Uoc2VsZiwgcmVzcG9uc2U6IExpc3QpIC0+IERpY3Q6CiAgICAgICAgYXJyID0gbnAuYXJyYXkocmVzcG9uc2UpCiAgICAgICAgdHkgPSBfZ2V0X3JlcXVlc3RfdHkoc2VsZi5yZXF1ZXN0KQogICAgICAgIHNlbGRvbl9kYXRhZGVmID0gX2NyZWF0ZV9zZWxkb25fZGF0YV9kZWYoYXJyLCB0eSkKICAgICAgICByZXR1cm4geyJkYXRhIjogc2VsZG9uX2RhdGFkZWZ9CgoKY2xhc3MgVGVuc29yZmxvd1JlcXVlc3RIYW5kbGVyKFJlcXVlc3RIYW5kbGVyKToKCiAgICBkZWYgX19pbml0X18oc2VsZiwgY29udGV4dCwKICAgICAgICAgICAgICAgICByZXF1ZXN0OiBEaWN0KTogICMgcHlsaW50OiBkaXNhYmxlPXVzZWxlc3Mtc3VwZXItZGVsZWdhdGlvbgogICAgICAgIHN1cGVyKCkuX19pbml0X18ocmVxdWVzdCkKICAgICAgICBzZWxmLmNvbnRleHQgPSBjb250ZXh0CgogICAgZGVmIHZhbGlkYXRlKHNlbGYpOgogICAgICAgIGlmICJpbnN0YW5jZXMiIG5vdCBpbiBzZWxmLnJlcXVlc3Q6CiAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbnRleHQuUmVzcG9uc2UoCiAgICAgICAgICAgICAgICBib2R5PSJFeHBlY3RlZCBrZXkgXCJpbnN0YW5jZXNcIiBpbiByZXF1ZXN0IGJvZHkiLAogICAgICAgICAgICAgICAgaGVhZGVycz17fSwKICAgICAgICAgICAgICAgIGNvbnRlbnRfdHlwZT0ndGV4dC9wbGFpbicsCiAgICAgICAgICAgICAgICBzdGF0dXNfY29kZT01MDApCgogICAgZGVmIGV4dHJhY3RfcmVxdWVzdChzZWxmKSAtPiBMaXN0OgogICAgICAgIHJldHVybiBzZWxmLnJlcXVlc3RbImluc3RhbmNlcyJdCgogICAgZGVmIHdyYXBfcmVzcG9uc2Uoc2VsZiwgcmVzcG9uc2U6IExpc3QpIC0+IERpY3Q6CiAgICAgICAgcmV0dXJuIHsicHJlZGljdGlvbnMiOiByZXNwb25zZX0KCgojIyMjIyMjIyMjIyMjIyMjIyMjIwojIFNlcnZpbmcgZnVuY3Rpb24gIwojIyMjIyMjIyMjIyMjIyMjIyMjIwoKIyBSb3V0ZXMKCmRlZiBwcmVkaWN0KGNvbnRleHQsIG1vZGVsX25hbWUsIHJlcXVlc3QpOgogICAgZ2xvYmFsIG1vZGVscwogICAgZ2xvYmFsIHByb3RvY29sCgogICAgIyBMb2FkIHRoZSByZXF1ZXN0ZWQgbW9kZWwKICAgIG1vZGVsID0gbW9kZWxzW21vZGVsX25hbWVdCgogICAgIyBWZXJpZnkgbW9kZWwgaXMgbG9hZGVkIChBc3luYykKICAgIGlmIG5vdCBtb2RlbC5yZWFkeToKICAgICAgICBtb2RlbC5sb2FkKCkKCiAgICAjIFZhbGlkYXRlIHJlcXVlc3QgdmlhIHByb3RvY29sCiAgICByZXF1ZXN0SGFuZGxlcjogUmVxdWVzdEhhbmRsZXIgPSBwcm90b2NvbChjb250ZXh0LCByZXF1ZXN0KQogICAgcmVxdWVzdEhhbmRsZXIudmFsaWRhdGUoKQogICAgcmVxdWVzdCA9IHJlcXVlc3RIYW5kbGVyLmV4dHJhY3RfcmVxdWVzdCgpCgogICAgIyBQcmVkaWN0CiAgICByZXN1bHRzID0gbW9kZWwucHJlZGljdChyZXF1ZXN0KQoKICAgICMgV3JhcCAmIHJldHVybiByZXNwb25zZQogICAgcmVzcG9uc2UgPSByZXF1ZXN0SGFuZGxlci53cmFwX3Jlc3BvbnNlKHJlc3VsdHMpCiAgICByZXR1cm4gcmVzcG9uc2UKCgpkZWYgbm9fcGF0aChyZXF1ZXN0KToKICAgIGNvbnRleHQubG9nZ2VyLmVycm9yKGYnUGF0aCB7cGF0aH0gZG9lcyBub3QgZXhpc3QnKQogICAgcmV0dXJuICcnCgoKIyBSb3V0ZXIKcGF0aHMgPSB7CiAgICAncHJlZGljdCc6IHByZWRpY3QsCiAgICAnZXhwbGFpbic6ICcnLAogICAgJ291dGxpZXJfZGV0ZWN0b3InOiAnJywKICAgICdtZXRyaWNzJzogJycsCn0KCiMgRGVmaW5pdGlvbnMKbW9kZWxfcHJlZml4ID0gJ1NFUlZJTkdfTU9ERUxfJwptb2RlbHMgPSB7fQoKIyBTZWxlY3QgbWVzc2FnaW5nIHByb3RvY29sCnByb3RvY29scyA9IHsKICAgICd0ZW5zb3JmbG93JzogVGVuc29yZmxvd1JlcXVlc3RIYW5kbGVyLAogICAgJ3NlbGRvbic6IFNlbGRvblJlcXVlc3RIYW5kbGVyCn0KcHJvdG9jb2wgPSBwcm90b2NvbHNbb3MuZW52aXJvbi5nZXQoJ1RSQU5TUE9SVF9QUk9UT0NPTCcsICd0ZW5zb3JmbG93JyldCgoKZGVmIGluaXRfY29udGV4dChjb250ZXh0KToKICAgIGdsb2JhbCBtb2RlbHMKICAgIGdsb2JhbCBtb2RlbF9wcmVmaXgKCiAgICAjIEluaXRpYWxpemUgbW9kZWxzIGZyb20gZW52aXJvbm1lbnQgdmFyaWFibGVzCiAgICAjIFVzaW5nIHRoZSB7bW9kZWxfcHJlZml4fV97bW9kZWxfbmFtZX0gPSB7bW9kZWxfcGF0aH0gc3ludGF4CiAgICBtb2RlbF9wYXRocyA9IHtrW2xlbihtb2RlbF9wcmVmaXgpOl06IHYgZm9yIGssIHYgaW4gb3MuZW52aXJvbi5pdGVtcygpIGlmCiAgICAgICAgICAgICAgICAgICBrLnN0YXJ0c3dpdGgobW9kZWxfcHJlZml4KX0KCiAgICBtb2RlbF9jbGFzcyA9IG9zLmVudmlyb24uZ2V0KCdNT0RFTF9DTEFTUycpCiAgICBmaGFuZGxlciA9IGdsb2JhbHMoKVttb2RlbF9jbGFzc10KICAgIG1vZGVscyA9IHtuYW1lOiBmaGFuZGxlcihuYW1lPW5hbWUsIG1vZGVsX2Rpcj1wYXRoKSBmb3IgbmFtZSwgcGF0aCBpbgogICAgICAgICAgICAgIG1vZGVsX3BhdGhzLml0ZW1zKCl9CiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYnTG9hZGVkIHtsaXN0KG1vZGVscy5rZXlzKCkpfScpCgoKZGVmIGhhbmRsZXIoY29udGV4dCwgZXZlbnQpOgogICAgZ2xvYmFsIG1vZGVscwogICAgZ2xvYmFsIHBhdGhzCgogICAgIyBMb2FkIGV2ZW50CiAgICBldmVudF9ib2R5ID0ganNvbi5sb2FkcyhldmVudC5ib2R5LCBlbmNvZGluZz0ndXRmOCcpCgogICAgIyBHZXQgcm91dGUgJiBtb2RlbCBmcm9tIGV2ZW50CiAgICBzcGxpdHRlZF9wYXRoID0gZXZlbnQucGF0aC5zdHJpcCgnLycpLnNwbGl0KCcvJykKICAgIGZ1bmN0aW9uX3BhdGggPSBzcGxpdHRlZF9wYXRoWzBdIGlmIGxlbihzcGxpdHRlZF9wYXRoKSA+IDAgZWxzZSAnJwogICAgdHJ5OgogICAgICAgIG1vZGVsX25hbWUgPSBzcGxpdHRlZF9wYXRoWzFdCiAgICBleGNlcHQ6CiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCdObyBtb2RlbCB3YXMgc3BlY2lmaWVkJykKCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKAogICAgICAgIGYnU2VydmluZyB1cmk6IHtldmVudC5wYXRofSBmb3Igcm91dGUge2Z1bmN0aW9uX3BhdGh9ICcKICAgICAgICBmJ3dpdGgge21vZGVsX25hbWV9JykKCiAgICAjIFZlcmlmeSByb3V0ZSB2YWxpZGl0eQogICAgaWYgbm90IGZ1bmN0aW9uX3BhdGggaW4gcGF0aHM6CiAgICAgICAgcmV0dXJuIGNvbnRleHQuUmVzcG9uc2UoYm9keT1mJ1BhdGgge2Z1bmN0aW9uX3BhdGh9IGRvZXMgbm90IGV4aXN0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPXt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRfdHlwZT0ndGV4dC9wbGFpbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzX2NvZGU9NDAwKQogICAgcm91dGUgPSBwYXRocy5nZXQoZnVuY3Rpb25fcGF0aCwgbm9fcGF0aCkKCiAgICAjIFZlcmlmeSBtb2RlbCBleGlzdHMKICAgIGlmIG5vdCBtb2RlbF9uYW1lIGluIG1vZGVsczoKICAgICAgICByYWlzZSBFeGNlcHRpb24oZidGYWlsZWQgdG8gbG9hZCBtb2RlbCB7bW9kZWxfbmFtZX0nKQoKICAgICMgUnVuIG1vZGVsCiAgICByZXR1cm4gcm91dGUoY29udGV4dCwgbW9kZWxfbmFtZSwgZXZlbnRfYm9keSkK', 'noBaseImagesPull': True}, 'env': [], 'handler': 'step-1-model-serving:handler', 'runtime': 'python:3.6', 'volumes': []}}, 'source': '', 'function_kind': 'serving'}}
      - |-
        -s
      - ""
      - |-
        -p
      - |-
        projects
      - |-
        -m
      - |-
        lgbm_v1={{inputs.parameters.train-model-model}}
      "image": |-
        mlrun/mlrun:latest
    "inputs":
      "parameters":
      - "name": |-
          train-model-model
    "name": |-
      deploy-higgs-serving
    "outputs":
      "artifacts":
      - "name": |-
          deploy-higgs-serving-endpoint
        "path": |-
          /tmp/output
  - "dag":
      "tasks":
      - "arguments":
          "parameters":
          - "name": |-
              train-model-model
            "value": |-
              {{tasks.train-model.outputs.parameters.train-model-model}}
        "dependencies":
        - |-
          train-model
        "name": |-
          deploy-higgs-serving
        "template": |-
          deploy-higgs-serving
      - "name": |-
          load-data
        "template": |-
          load-data
      - "arguments":
          "parameters":
          - "name": |-
              learning_rate
            "value": |-
              {{inputs.parameters.learning_rate}}
          - "name": |-
              num_leaves
            "value": |-
              {{inputs.parameters.num_leaves}}
          - "name": |-
              train-model-model
            "value": |-
              {{tasks.train-model.outputs.parameters.train-model-model}}
          - "name": |-
              train-model-xtest
            "value": |-
              {{tasks.train-model.outputs.parameters.train-model-xtest}}
          - "name": |-
              train-model-ytest
            "value": |-
              {{tasks.train-model.outputs.parameters.train-model-ytest}}
        "dependencies":
        - |-
          train-model
        "name": |-
          test-model
        "template": |-
          test-model
      - "arguments":
          "parameters":
          - "name": |-
              load-data-features
            "value": |-
              {{tasks.load-data.outputs.parameters.load-data-features}}
          - "name": |-
              load-data-labels
            "value": |-
              {{tasks.load-data.outputs.parameters.load-data-labels}}
        "dependencies":
        - |-
          load-data
        "name": |-
          train-model
        "template": |-
          train-model
    "inputs":
      "parameters":
      - "name": |-
          learning_rate
      - "name": |-
          num_leaves
    "name": |-
      lgbmclassifier-training-pipeline
  - "container":
      "command":
      - |-
        python
      - |-
        -m
      - |-
        mlrun
      - |-
        run
      - |-
        --kfp
      - |-
        --from-env
      - |-
        --workflow
      - |-
        {{workflow.uid}}
      - |-
        --name
      - |-
        load_data
      - |-
        -p
      - |-
        target=
      - |-
        -p
      - |-
        randstate=1
      - |-
        -o
      - |-
        features
      - |-
        -o
      - |-
        labels
      - |-
        --handler
      - |-
        load
      - |-
        --runtime
      - |-
        {'kind': 'job', 'metadata': {'name': 'step-2---kfp-pipeline'}, 'spec': {'command': '', 'args': [], 'image': 'docker-registry.default-tenant.app.yjb-3.iguazio-cd2.com:80/mlrun/mlrunlgb:latest', 'mode': '', 'volumes': [{'flexVolume': {'driver': 'v3io/fuse', 'options': {'accessKey': '4a5eabdc-0814-489e-9fdf-6ad2fa5df31d', 'container': 'users', 'subPath': '/admin'}}, 'name': 'v3io'}], 'volume_mounts': [{'mountPath': '/User', 'name': 'v3io'}], 'env': [{'name': 'V3IO_API', 'value': 'v3io-webapi.default-tenant.svc:8081'}, {'name': 'V3IO_USERNAME', 'value': 'admin'}, {'name': 'V3IO_ACCESS_KEY', 'value': '4a5eabdc-0814-489e-9fdf-6ad2fa5df31d'}], 'description': '', 'build': {'functionSourceCode': 'IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlciBvbiAyMDE5LTEyLTExIDE0OjI0CgppbXBvcnQgb3MKaW1wb3J0IHBpY2tsZQpmcm9tIGlvIGltcG9ydCBTdHJpbmdJTwpmcm9tIHVybGxpYi5yZXF1ZXN0IGltcG9ydCB1cmxyZXRyaWV2ZQoKaW1wb3J0IG1hdHBsb3RsaWIucHlwbG90IGFzIHBsdApmcm9tIHNrbGVhcm4ubWV0cmljcyBpbXBvcnQgcm9jX2F1Y19zY29yZSwgcm9jX2N1cnZlLCBhY2N1cmFjeV9zY29yZQpmcm9tIHNrbGVhcm4ubW9kZWxfc2VsZWN0aW9uIGltcG9ydCB0cmFpbl90ZXN0X3NwbGl0CmZyb20gc2tsZWFybi5leHRlcm5hbHMgaW1wb3J0IGpvYmxpYgpmcm9tIHNrbGVhcm4ucHJlcHJvY2Vzc2luZyBpbXBvcnQgT25lSG90RW5jb2RlcgoKaW1wb3J0IGxpZ2h0Z2JtIGFzIGxnYgppbXBvcnQgcGFuZGFzIGFzIHBkCmZyb20gbWxydW4uYXJ0aWZhY3RzIGltcG9ydCBDaGFydEFydGlmYWN0LCBUYWJsZUFydGlmYWN0LCBQbG90QXJ0aWZhY3QKCmltcG9ydCB3YXJuaW5ncwp3YXJuaW5ncy5maWx0ZXJ3YXJuaW5ncygnaWdub3JlJykKCmRlZiBfZ2V0X2NvbnRleHRfdGFibGUoY3R4dGFibGUsIGVuY29kaW5nPSd1dGYtOCcpOgogICAgIiIiRXh0cmFjdCBhIHBhbmRhcyBEYXRhRnJhbWUgZnJvbSB0aGUgYGNvbnRleHRgLgogICAgIiIiCiAgICB0YWJsZV9zdHIgPSBTdHJpbmdJTyhzdHIoY3R4dGFibGUuZ2V0KCksIGVuY29kaW5nKSkKICAgIHJldHVybiBwZC5yZWFkX2Nzdih0YWJsZV9zdHIpCgpkZWYgX2dldF9jb250ZXh0X21vZGVsKAogICAgY3R4bW9kZWwsIAogICAgbW9kZWxfdHlwZT1sZ2IuQm9vc3RlciwgCiAgICBlbmNvZGluZz0ndXRmLTgnCik6CiAgICAiIiJEZXNlcmlhbGl6ZSBhIG1vZGVsIGZyb20gdGhlIGBjb250ZXh0YC4KICAgICIiIgogICAgd2l0aCBvcGVuKGYnL1VzZXIvcHJvamVjdHMvaGlnZ3Mve2N0eG1vZGVsfScsICdyYicpIGFzIG1vZGVsX2ZoOiAKICAgICAgICBjbGYyID0gcGlja2xlLmxvYWRzKG1vZGVsX2ZoLnJlYWQoKSkKICAgIHJldHVybiBjbGYyCgpkZWYgX3RyYWluX3ZhbGlkX3Rlc3Rfc3BsaXRzKHgsIHksIHJhbmRzdGF0ZT0xKToKICAgICIiIlNwbGl0cyBkYXRhIGludG8gdHJhaW4sIHZhbGlkYXRpb24gYW5kIHRlc3Qgc2V0cy4KICAgICIiIgogICAgeCwgWHRlc3QsIHksIHl0ZXN0ID0gdHJhaW5fdGVzdF9zcGxpdCh4LCB5LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVzdF9zaXplPTAuMTAsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFpbl9zaXplPTAuOTAsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5kb21fc3RhdGU9cmFuZHN0YXRlKQogICAgCiAgICBYdHJhaW4sIFh2YWxpZCwgeXRyYWluLCB5dmFsaWQgPSB0cmFpbl90ZXN0X3NwbGl0KHgsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVzdF9zaXplID0gMC4yNSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYWluX3NpemUgPTAuNzUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5kb21fc3RhdGU9cmFuZHN0YXRlKQogICAgcmV0dXJuIFh0cmFpbiwgWHZhbGlkLCBYdGVzdCwgeXRyYWluLCB5dmFsaWQsIHl0ZXN0CgpkZWYgbG9hZChjb250ZXh0LAogICAgICAgICB0YXJnZXQ9JycsCiAgICAgICAgIHJhbmRzdGF0ZSA9IDEKKToKICAgICIiIkxvYWQgcmF3IGRhdGEgYXJ0aWZhY3RzLgogICAgIiIiCiAgICAKICAgIGhlYWRlciA9IFsnbGFiZWxzJywgJ2xlcHRvbiBwVCAnLCAnbGVwdG9uIGV0YSAnLCAnbGVwdG9uIHBoaSAnLAogICAgICAgICAgICdtaXNzaW5nIGVuZXJneSBtYWduaXR1ZGUgJywgJ21pc3NpbmcgZW5lcmd5IHBoaSAnLCAnamV0IDEgcHQgJywKICAgICAgICAgICAnamV0IDEgZXRhICcsICdqZXQgMSBwaGkgJywgJ2pldCAxIGItdGFnICcsICdqZXQgMiBwdCAnLAogICAgICAgICAgICdqZXQgMiBldGEgJywgJ2pldCAyIHBoaSAnLCAnamV0IDIgYi10YWcgJywgJ2pldCAzIHB0ICcsCiAgICAgICAgICAgJ2pldCAzIGV0YSAnLCAnamV0IDMgcGhpICcsICdqZXQgMyBiLXRhZyAnLCAnamV0IDQgcHQgJywKICAgICAgICAgICAnamV0IDQgZXRhICcsICdqZXQgNCBwaGkgJywgJ2pldCA0IGItdGFnJywgJ21famonLCAnbV9qamonLAogICAgICAgICAgICdtX2x2ICcsICdtX2psdicsICdtX2JiICcsICdtX3diYiAnLCAnbV93d2JiJ10gICAgCiAgICAKICAgIHJhd19kYXRhID0gcGQucmVhZF9jc3YoJy9Vc2VyL3Byb2plY3RzL2hpZ2dzL2RhdGEvSElHR1MuY3N2JywgbmFtZXM9aGVhZGVyKQogICAgbGFiZWxzID0gcmF3X2RhdGEucG9wKCdsYWJlbHMnKQogICAgCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChUYWJsZUFydGlmYWN0KCdmZWF0dXJlcycsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZj1yYXdfZGF0YSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldF9wYXRoPSdmZWF0dXJlcy5jc3YnKSkKICAgIAogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoVGFibGVBcnRpZmFjdCgnbGFiZWxzJywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRmPXBkLkRhdGFGcmFtZShsYWJlbHMsIGNvbHVtbnM9WydsYWJlbHMnXSksIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfcGF0aD0nbGFiZWxzLmNzdicpKQoKZGVmIHRyYWluKGNvbnRleHQsCiAgICAgICAgICBmZWF0dXJlcywKICAgICAgICAgIGxhYmVscywKICAgICAgICAgIGJvb3N0X3JvdW5kPTYsCiAgICAgICAgICBudW1fbGVhdmVzPTMxLAogICAgICAgICAgbGVhcm5pbmdfcmF0ZT0gMC4xLAogICAgICAgICAgdGFyZ2V0X3BhdGg9JycKICAgICk6CiAgICAiIiJUcmFpbiBhbmQgc2F2ZSB0aGUgbGlnaHRnYm0gbW9kZWwuCiAgICAiIiIKICAgIHJhbmRzdGF0ZSA9IDEKICAgIGxnYmZpdF92ZXJib3NlID0gVHJ1ZQogICAgCiAgICBsZ2JfY2xmID0gbGdiLkxHQk1DbGFzc2lmaWVyKGJvb3N0X3JvdW5kPTYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bV9sZWF2ZXM9MzEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXJuaW5nX3JhdGU9IDAuMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0aXZlPSdiaW5hcnknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRyaWM9J2JpbmFyeV9sb2dsb3NzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZG9tX3N0YXRlPXJhbmRzdGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lsZW50PVRydWUpCgogICAgZmVhdHVyZXMgPSBfZ2V0X2NvbnRleHRfdGFibGUoZmVhdHVyZXMpCiAgICBsYWJlbHMgPSBfZ2V0X2NvbnRleHRfdGFibGUobGFiZWxzKQogICAgCiAgICBYdHJhaW4sIFh2YWxpZCwgWHRlc3QsIHl0cmFpbiwgeXZhbGlkLCB5dGVzdCA9ICAgICAgICAgX3RyYWluX3ZhbGlkX3Rlc3Rfc3BsaXRzKGZlYXR1cmVzLCBsYWJlbHMsIHJhbmRzdGF0ZSkKICAgIAogICAgbGdiX2NsZi5maXQoWHRyYWluLCAKICAgICAgICAgICAgICAgeXRyYWluLAogICAgICAgICAgICAgICBldmFsX3NldD1bKFh2YWxpZCwgeXZhbGlkKSwgKFh0cmFpbiwgeXRyYWluKV0sCiAgICAgICAgICAgICAgIGV2YWxfbmFtZXM9Wyd2YWxpZCcsICd0cmFpbiddLAogICAgICAgICAgICAgICB2ZXJib3NlPWxnYmZpdF92ZXJib3NlKQogICAgCiAgICAKICAgIG1vZGVsX2J5dGVzID0gcGlja2xlLmR1bXBzKGxnYl9jbGYpCiAgICAgICAgICAgICAgICAgCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdCgnbW9kZWwnLCAKICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHk9bW9kZWxfYnl0ZXMsIAogICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3BhdGg9J21vZGVsLnR4dCcsIAogICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxzPXsnZnJhbWV3b3JrJzogJ2xnYm1ib29zdCd9KQogICAgCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChUYWJsZUFydGlmYWN0KCd4dGVzdCcsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZj1YdGVzdCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldF9wYXRoPSd4dGVzdC5jc3YnKSkKICAgIAogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoVGFibGVBcnRpZmFjdCgneXRlc3QnLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGY9cGQuRGF0YUZyYW1lKHl0ZXN0LCBjb2x1bW5zPVsnbGFiZWxzJ10pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfcGF0aD0neXRlc3QuY3N2JykpCgpkZWYgcGxvdF9yb2MoeXRlc3QsIHlwcmVkLCBkZXN0cGF0aCwgZm10PSJwbmciKToKICAgIGZwcl94ZywgdHByX3hnLCBfID0gcm9jX2N1cnZlKHl0ZXN0LCB5cHJlZCkKCiAgICBwbHQucGxvdChbMCwgMV0sIFswLCAxXSwgJ2stLScpCiAgICBwbHQucGxvdChmcHJfeGcsIHRwcl94ZywgbGFiZWw9J3hnYm9vc3QnKQogICAgcGx0LnhsYWJlbCgnRmFsc2UgcG9zaXRpdmUgcmF0ZScpCiAgICBwbHQueWxhYmVsKCdUcnVlIHBvc2l0aXZlIHJhdGUnKQogICAgcGx0LnRpdGxlKCdyb2MgY3VydmUgLSBsaWdodGdibScpCiAgICBwbHQubGVnZW5kKGxvYz0nYmVzdCcpCiAgICBwbHQuc2F2ZWZpZyhkZXN0cGF0aC5yZXBsYWNlKCcuJywnLScpLCBmb3JtYXQ9Zm10KQogICAgZmlnID0gcGx0LmdjZigpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3QoJ3JvYy1jdXJ2ZScsIGJvZHk9ZmlnKSkKCmRlZiB0ZXN0KGNvbnRleHQsIG1vZGVsLCB4dGVzdCwgeXRlc3QsIHRhcmdldD0nJyk6CiAgICAiIiJMb2FkIG1vZGVsIGFuZCBwcmVkaWN0CiAgICAiIiIKICAgIGxnYm1fbW9kZWwgPSBfZ2V0X2NvbnRleHRfbW9kZWwobW9kZWwpCiAgICAKICAgIHh0ZXN0ID0gX2dldF9jb250ZXh0X3RhYmxlKHh0ZXN0KQogICAgeXRlc3QgPSBfZ2V0X2NvbnRleHRfdGFibGUoeXRlc3QpLnZhbHVlcwogICAgIAogICAgeXByZWQgPSBsZ2JtX21vZGVsLnByZWRpY3QoeHRlc3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICBwcmludChmJ2F1Y19zY29yZSB7cm9jX2F1Y19zY29yZSh5dGVzdCwgeXByZWQpOjAuMmZ9JykKICAgIGNvbnRleHQubG9nX3Jlc3VsdCgnYWNjdXJhY3knLCBmbG9hdChhY2N1cmFjeV9zY29yZSh5dGVzdCwgeXByZWQpKSkKCiAgICBkZWYgcGxvdF9yb2MoeXRlc3QsIHlwcmVkLCBkZXN0cGF0aCwgZm10PSJwbmciKToKICAgICAgICBmcHJfeGcsIHRwcl94ZywgXyA9IHJvY19jdXJ2ZSh5dGVzdCwgeXByZWQpCgogICAgICAgIHBsdC5wbG90KFswLCAxXSwgWzAsIDFdLCAnay0tJykKICAgICAgICBwbHQucGxvdChmcHJfeGcsIHRwcl94ZywgbGFiZWw9J3hnYm9vc3QnKQogICAgICAgIHBsdC54bGFiZWwoJ0ZhbHNlIHBvc2l0aXZlIHJhdGUnKQogICAgICAgIHBsdC55bGFiZWwoJ1RydWUgcG9zaXRpdmUgcmF0ZScpCiAgICAgICAgcGx0LnRpdGxlKCdyb2MgY3VydmUgLSBsaWdodGdibScpCiAgICAgICAgcGx0LmxlZ2VuZChsb2M9J2Jlc3QnKQogICAgICAgIHBsdC5zYXZlZmlnKGRlc3RwYXRoLnJlcGxhY2UoJy4nLCctJyksIGZvcm1hdD1mbXQpCiAgICAgICAgZmlnID0gcGx0LmdjZigpCiAgICAgICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoUGxvdEFydGlmYWN0KCdyb2MtY3VydmUnLCBib2R5PWZpZykpCgogICAgcGxvdF9yb2MoeXRlc3QsIAogICAgICAgICAgICAgeXByZWQsIAogICAgICAgICAgICAgJ21vZGVsLnR4dCcsCiAgICAgICAgICAgICBmbXQ9J3BuZycpCgo=', 'image': 'mlrun/mlrunlgb:latest', 'base_image': 'python:3.6-jessie', 'commands': ['pip install -U matplotlib sklearn lightgbm kfp', 'pip install mlrun']}}}
      - ""
      "env":
      - "name": |-
          V3IO_API
        "value": |-
          v3io-webapi.default-tenant.svc:8081
      - "name": |-
          V3IO_USERNAME
        "value": |-
          admin
      - "name": |-
          V3IO_ACCESS_KEY
        "value": |-
          4a5eabdc-0814-489e-9fdf-6ad2fa5df31d
      "image": |-
        mlrun/mlrun:latest
      "volumeMounts":
      - "mountPath": |-
          /User
        "name": |-
          v3io
    "name": |-
      load-data
    "outputs":
      "artifacts":
      - "name": |-
          mlpipeline-ui-metadata
        "path": |-
          /mlpipeline-ui-metadata.json
      - "name": |-
          mlpipeline-metrics
        "path": |-
          /mlpipeline-metrics.json
      - "name": |-
          load-data-features
        "path": |-
          /tmp/features
      - "name": |-
          load-data-labels
        "path": |-
          /tmp/labels
      "parameters":
      - "name": |-
          load-data-features
        "valueFrom":
          "path": |-
            /tmp/features
      - "name": |-
          load-data-labels
        "valueFrom":
          "path": |-
            /tmp/labels
    "volumes":
    - "flexVolume":
        "driver": |-
          v3io/fuse
        "options":
          "accessKey": |-
            4a5eabdc-0814-489e-9fdf-6ad2fa5df31d
          "container": |-
            users
          "subPath": |-
            /admin
      "name": |-
        v3io
  - "container":
      "command":
      - |-
        python
      - |-
        -m
      - |-
        mlrun
      - |-
        run
      - |-
        --kfp
      - |-
        --from-env
      - |-
        --workflow
      - |-
        {{workflow.uid}}
      - |-
        --name
      - |-
        test_model
      - |-
        -p
      - |-
        target=
      - |-
        -x
      - |-
        learning_rate={{inputs.parameters.learning_rate}}
      - |-
        -x
      - |-
        num_leaves={{inputs.parameters.num_leaves}}
      - |-
        -i
      - |-
        model={{inputs.parameters.train-model-model}}
      - |-
        -i
      - |-
        xtest={{inputs.parameters.train-model-xtest}}
      - |-
        -i
      - |-
        ytest={{inputs.parameters.train-model-ytest}}
      - |-
        -o
      - |-
        iteration_results
      - |-
        --handler
      - |-
        test
      - |-
        --runtime
      - |-
        {'kind': 'job', 'metadata': {'name': 'step-2---kfp-pipeline'}, 'spec': {'command': '', 'args': [], 'image': 'docker-registry.default-tenant.app.yjb-3.iguazio-cd2.com:80/mlrun/mlrunlgb:latest', 'mode': '', 'volumes': [{'flexVolume': {'driver': 'v3io/fuse', 'options': {'accessKey': '4a5eabdc-0814-489e-9fdf-6ad2fa5df31d', 'container': 'users', 'subPath': '/admin'}}, 'name': 'v3io'}], 'volume_mounts': [{'mountPath': '/User', 'name': 'v3io'}], 'env': [{'name': 'V3IO_API', 'value': 'v3io-webapi.default-tenant.svc:8081'}, {'name': 'V3IO_USERNAME', 'value': 'admin'}, {'name': 'V3IO_ACCESS_KEY', 'value': '4a5eabdc-0814-489e-9fdf-6ad2fa5df31d'}], 'description': '', 'build': {'functionSourceCode': 'IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlciBvbiAyMDE5LTEyLTExIDE0OjI0CgppbXBvcnQgb3MKaW1wb3J0IHBpY2tsZQpmcm9tIGlvIGltcG9ydCBTdHJpbmdJTwpmcm9tIHVybGxpYi5yZXF1ZXN0IGltcG9ydCB1cmxyZXRyaWV2ZQoKaW1wb3J0IG1hdHBsb3RsaWIucHlwbG90IGFzIHBsdApmcm9tIHNrbGVhcm4ubWV0cmljcyBpbXBvcnQgcm9jX2F1Y19zY29yZSwgcm9jX2N1cnZlLCBhY2N1cmFjeV9zY29yZQpmcm9tIHNrbGVhcm4ubW9kZWxfc2VsZWN0aW9uIGltcG9ydCB0cmFpbl90ZXN0X3NwbGl0CmZyb20gc2tsZWFybi5leHRlcm5hbHMgaW1wb3J0IGpvYmxpYgpmcm9tIHNrbGVhcm4ucHJlcHJvY2Vzc2luZyBpbXBvcnQgT25lSG90RW5jb2RlcgoKaW1wb3J0IGxpZ2h0Z2JtIGFzIGxnYgppbXBvcnQgcGFuZGFzIGFzIHBkCmZyb20gbWxydW4uYXJ0aWZhY3RzIGltcG9ydCBDaGFydEFydGlmYWN0LCBUYWJsZUFydGlmYWN0LCBQbG90QXJ0aWZhY3QKCmltcG9ydCB3YXJuaW5ncwp3YXJuaW5ncy5maWx0ZXJ3YXJuaW5ncygnaWdub3JlJykKCmRlZiBfZ2V0X2NvbnRleHRfdGFibGUoY3R4dGFibGUsIGVuY29kaW5nPSd1dGYtOCcpOgogICAgIiIiRXh0cmFjdCBhIHBhbmRhcyBEYXRhRnJhbWUgZnJvbSB0aGUgYGNvbnRleHRgLgogICAgIiIiCiAgICB0YWJsZV9zdHIgPSBTdHJpbmdJTyhzdHIoY3R4dGFibGUuZ2V0KCksIGVuY29kaW5nKSkKICAgIHJldHVybiBwZC5yZWFkX2Nzdih0YWJsZV9zdHIpCgpkZWYgX2dldF9jb250ZXh0X21vZGVsKAogICAgY3R4bW9kZWwsIAogICAgbW9kZWxfdHlwZT1sZ2IuQm9vc3RlciwgCiAgICBlbmNvZGluZz0ndXRmLTgnCik6CiAgICAiIiJEZXNlcmlhbGl6ZSBhIG1vZGVsIGZyb20gdGhlIGBjb250ZXh0YC4KICAgICIiIgogICAgd2l0aCBvcGVuKGYnL1VzZXIvcHJvamVjdHMvaGlnZ3Mve2N0eG1vZGVsfScsICdyYicpIGFzIG1vZGVsX2ZoOiAKICAgICAgICBjbGYyID0gcGlja2xlLmxvYWRzKG1vZGVsX2ZoLnJlYWQoKSkKICAgIHJldHVybiBjbGYyCgpkZWYgX3RyYWluX3ZhbGlkX3Rlc3Rfc3BsaXRzKHgsIHksIHJhbmRzdGF0ZT0xKToKICAgICIiIlNwbGl0cyBkYXRhIGludG8gdHJhaW4sIHZhbGlkYXRpb24gYW5kIHRlc3Qgc2V0cy4KICAgICIiIgogICAgeCwgWHRlc3QsIHksIHl0ZXN0ID0gdHJhaW5fdGVzdF9zcGxpdCh4LCB5LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVzdF9zaXplPTAuMTAsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFpbl9zaXplPTAuOTAsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5kb21fc3RhdGU9cmFuZHN0YXRlKQogICAgCiAgICBYdHJhaW4sIFh2YWxpZCwgeXRyYWluLCB5dmFsaWQgPSB0cmFpbl90ZXN0X3NwbGl0KHgsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVzdF9zaXplID0gMC4yNSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYWluX3NpemUgPTAuNzUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5kb21fc3RhdGU9cmFuZHN0YXRlKQogICAgcmV0dXJuIFh0cmFpbiwgWHZhbGlkLCBYdGVzdCwgeXRyYWluLCB5dmFsaWQsIHl0ZXN0CgpkZWYgbG9hZChjb250ZXh0LAogICAgICAgICB0YXJnZXQ9JycsCiAgICAgICAgIHJhbmRzdGF0ZSA9IDEKKToKICAgICIiIkxvYWQgcmF3IGRhdGEgYXJ0aWZhY3RzLgogICAgIiIiCiAgICAKICAgIGhlYWRlciA9IFsnbGFiZWxzJywgJ2xlcHRvbiBwVCAnLCAnbGVwdG9uIGV0YSAnLCAnbGVwdG9uIHBoaSAnLAogICAgICAgICAgICdtaXNzaW5nIGVuZXJneSBtYWduaXR1ZGUgJywgJ21pc3NpbmcgZW5lcmd5IHBoaSAnLCAnamV0IDEgcHQgJywKICAgICAgICAgICAnamV0IDEgZXRhICcsICdqZXQgMSBwaGkgJywgJ2pldCAxIGItdGFnICcsICdqZXQgMiBwdCAnLAogICAgICAgICAgICdqZXQgMiBldGEgJywgJ2pldCAyIHBoaSAnLCAnamV0IDIgYi10YWcgJywgJ2pldCAzIHB0ICcsCiAgICAgICAgICAgJ2pldCAzIGV0YSAnLCAnamV0IDMgcGhpICcsICdqZXQgMyBiLXRhZyAnLCAnamV0IDQgcHQgJywKICAgICAgICAgICAnamV0IDQgZXRhICcsICdqZXQgNCBwaGkgJywgJ2pldCA0IGItdGFnJywgJ21famonLCAnbV9qamonLAogICAgICAgICAgICdtX2x2ICcsICdtX2psdicsICdtX2JiICcsICdtX3diYiAnLCAnbV93d2JiJ10gICAgCiAgICAKICAgIHJhd19kYXRhID0gcGQucmVhZF9jc3YoJy9Vc2VyL3Byb2plY3RzL2hpZ2dzL2RhdGEvSElHR1MuY3N2JywgbmFtZXM9aGVhZGVyKQogICAgbGFiZWxzID0gcmF3X2RhdGEucG9wKCdsYWJlbHMnKQogICAgCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChUYWJsZUFydGlmYWN0KCdmZWF0dXJlcycsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZj1yYXdfZGF0YSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldF9wYXRoPSdmZWF0dXJlcy5jc3YnKSkKICAgIAogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoVGFibGVBcnRpZmFjdCgnbGFiZWxzJywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRmPXBkLkRhdGFGcmFtZShsYWJlbHMsIGNvbHVtbnM9WydsYWJlbHMnXSksIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfcGF0aD0nbGFiZWxzLmNzdicpKQoKZGVmIHRyYWluKGNvbnRleHQsCiAgICAgICAgICBmZWF0dXJlcywKICAgICAgICAgIGxhYmVscywKICAgICAgICAgIGJvb3N0X3JvdW5kPTYsCiAgICAgICAgICBudW1fbGVhdmVzPTMxLAogICAgICAgICAgbGVhcm5pbmdfcmF0ZT0gMC4xLAogICAgICAgICAgdGFyZ2V0X3BhdGg9JycKICAgICk6CiAgICAiIiJUcmFpbiBhbmQgc2F2ZSB0aGUgbGlnaHRnYm0gbW9kZWwuCiAgICAiIiIKICAgIHJhbmRzdGF0ZSA9IDEKICAgIGxnYmZpdF92ZXJib3NlID0gVHJ1ZQogICAgCiAgICBsZ2JfY2xmID0gbGdiLkxHQk1DbGFzc2lmaWVyKGJvb3N0X3JvdW5kPTYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bV9sZWF2ZXM9MzEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXJuaW5nX3JhdGU9IDAuMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0aXZlPSdiaW5hcnknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRyaWM9J2JpbmFyeV9sb2dsb3NzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZG9tX3N0YXRlPXJhbmRzdGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lsZW50PVRydWUpCgogICAgZmVhdHVyZXMgPSBfZ2V0X2NvbnRleHRfdGFibGUoZmVhdHVyZXMpCiAgICBsYWJlbHMgPSBfZ2V0X2NvbnRleHRfdGFibGUobGFiZWxzKQogICAgCiAgICBYdHJhaW4sIFh2YWxpZCwgWHRlc3QsIHl0cmFpbiwgeXZhbGlkLCB5dGVzdCA9ICAgICAgICAgX3RyYWluX3ZhbGlkX3Rlc3Rfc3BsaXRzKGZlYXR1cmVzLCBsYWJlbHMsIHJhbmRzdGF0ZSkKICAgIAogICAgbGdiX2NsZi5maXQoWHRyYWluLCAKICAgICAgICAgICAgICAgeXRyYWluLAogICAgICAgICAgICAgICBldmFsX3NldD1bKFh2YWxpZCwgeXZhbGlkKSwgKFh0cmFpbiwgeXRyYWluKV0sCiAgICAgICAgICAgICAgIGV2YWxfbmFtZXM9Wyd2YWxpZCcsICd0cmFpbiddLAogICAgICAgICAgICAgICB2ZXJib3NlPWxnYmZpdF92ZXJib3NlKQogICAgCiAgICAKICAgIG1vZGVsX2J5dGVzID0gcGlja2xlLmR1bXBzKGxnYl9jbGYpCiAgICAgICAgICAgICAgICAgCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdCgnbW9kZWwnLCAKICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHk9bW9kZWxfYnl0ZXMsIAogICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3BhdGg9J21vZGVsLnR4dCcsIAogICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxzPXsnZnJhbWV3b3JrJzogJ2xnYm1ib29zdCd9KQogICAgCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChUYWJsZUFydGlmYWN0KCd4dGVzdCcsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZj1YdGVzdCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldF9wYXRoPSd4dGVzdC5jc3YnKSkKICAgIAogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoVGFibGVBcnRpZmFjdCgneXRlc3QnLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGY9cGQuRGF0YUZyYW1lKHl0ZXN0LCBjb2x1bW5zPVsnbGFiZWxzJ10pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfcGF0aD0neXRlc3QuY3N2JykpCgpkZWYgcGxvdF9yb2MoeXRlc3QsIHlwcmVkLCBkZXN0cGF0aCwgZm10PSJwbmciKToKICAgIGZwcl94ZywgdHByX3hnLCBfID0gcm9jX2N1cnZlKHl0ZXN0LCB5cHJlZCkKCiAgICBwbHQucGxvdChbMCwgMV0sIFswLCAxXSwgJ2stLScpCiAgICBwbHQucGxvdChmcHJfeGcsIHRwcl94ZywgbGFiZWw9J3hnYm9vc3QnKQogICAgcGx0LnhsYWJlbCgnRmFsc2UgcG9zaXRpdmUgcmF0ZScpCiAgICBwbHQueWxhYmVsKCdUcnVlIHBvc2l0aXZlIHJhdGUnKQogICAgcGx0LnRpdGxlKCdyb2MgY3VydmUgLSBsaWdodGdibScpCiAgICBwbHQubGVnZW5kKGxvYz0nYmVzdCcpCiAgICBwbHQuc2F2ZWZpZyhkZXN0cGF0aC5yZXBsYWNlKCcuJywnLScpLCBmb3JtYXQ9Zm10KQogICAgZmlnID0gcGx0LmdjZigpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3QoJ3JvYy1jdXJ2ZScsIGJvZHk9ZmlnKSkKCmRlZiB0ZXN0KGNvbnRleHQsIG1vZGVsLCB4dGVzdCwgeXRlc3QsIHRhcmdldD0nJyk6CiAgICAiIiJMb2FkIG1vZGVsIGFuZCBwcmVkaWN0CiAgICAiIiIKICAgIGxnYm1fbW9kZWwgPSBfZ2V0X2NvbnRleHRfbW9kZWwobW9kZWwpCiAgICAKICAgIHh0ZXN0ID0gX2dldF9jb250ZXh0X3RhYmxlKHh0ZXN0KQogICAgeXRlc3QgPSBfZ2V0X2NvbnRleHRfdGFibGUoeXRlc3QpLnZhbHVlcwogICAgIAogICAgeXByZWQgPSBsZ2JtX21vZGVsLnByZWRpY3QoeHRlc3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICBwcmludChmJ2F1Y19zY29yZSB7cm9jX2F1Y19zY29yZSh5dGVzdCwgeXByZWQpOjAuMmZ9JykKICAgIGNvbnRleHQubG9nX3Jlc3VsdCgnYWNjdXJhY3knLCBmbG9hdChhY2N1cmFjeV9zY29yZSh5dGVzdCwgeXByZWQpKSkKCiAgICBkZWYgcGxvdF9yb2MoeXRlc3QsIHlwcmVkLCBkZXN0cGF0aCwgZm10PSJwbmciKToKICAgICAgICBmcHJfeGcsIHRwcl94ZywgXyA9IHJvY19jdXJ2ZSh5dGVzdCwgeXByZWQpCgogICAgICAgIHBsdC5wbG90KFswLCAxXSwgWzAsIDFdLCAnay0tJykKICAgICAgICBwbHQucGxvdChmcHJfeGcsIHRwcl94ZywgbGFiZWw9J3hnYm9vc3QnKQogICAgICAgIHBsdC54bGFiZWwoJ0ZhbHNlIHBvc2l0aXZlIHJhdGUnKQogICAgICAgIHBsdC55bGFiZWwoJ1RydWUgcG9zaXRpdmUgcmF0ZScpCiAgICAgICAgcGx0LnRpdGxlKCdyb2MgY3VydmUgLSBsaWdodGdibScpCiAgICAgICAgcGx0LmxlZ2VuZChsb2M9J2Jlc3QnKQogICAgICAgIHBsdC5zYXZlZmlnKGRlc3RwYXRoLnJlcGxhY2UoJy4nLCctJyksIGZvcm1hdD1mbXQpCiAgICAgICAgZmlnID0gcGx0LmdjZigpCiAgICAgICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoUGxvdEFydGlmYWN0KCdyb2MtY3VydmUnLCBib2R5PWZpZykpCgogICAgcGxvdF9yb2MoeXRlc3QsIAogICAgICAgICAgICAgeXByZWQsIAogICAgICAgICAgICAgJ21vZGVsLnR4dCcsCiAgICAgICAgICAgICBmbXQ9J3BuZycpCgo=', 'image': 'mlrun/mlrunlgb:latest', 'base_image': 'python:3.6-jessie', 'commands': ['pip install -U matplotlib sklearn lightgbm kfp', 'pip install mlrun']}}}
      - |-
        --selector
      - |-
        max.accuracy
      - ""
      "env":
      - "name": |-
          V3IO_API
        "value": |-
          v3io-webapi.default-tenant.svc:8081
      - "name": |-
          V3IO_USERNAME
        "value": |-
          admin
      - "name": |-
          V3IO_ACCESS_KEY
        "value": |-
          4a5eabdc-0814-489e-9fdf-6ad2fa5df31d
      "image": |-
        mlrun/mlrun:latest
      "volumeMounts":
      - "mountPath": |-
          /User
        "name": |-
          v3io
    "inputs":
      "parameters":
      - "name": |-
          learning_rate
      - "name": |-
          num_leaves
      - "name": |-
          train-model-model
      - "name": |-
          train-model-xtest
      - "name": |-
          train-model-ytest
    "name": |-
      test-model
    "outputs":
      "artifacts":
      - "name": |-
          mlpipeline-ui-metadata
        "path": |-
          /mlpipeline-ui-metadata.json
      - "name": |-
          mlpipeline-metrics
        "path": |-
          /mlpipeline-metrics.json
      - "name": |-
          test-model-iteration_results
        "path": |-
          /tmp/iteration_results
    "volumes":
    - "flexVolume":
        "driver": |-
          v3io/fuse
        "options":
          "accessKey": |-
            4a5eabdc-0814-489e-9fdf-6ad2fa5df31d
          "container": |-
            users
          "subPath": |-
            /admin
      "name": |-
        v3io
  - "container":
      "command":
      - |-
        python
      - |-
        -m
      - |-
        mlrun
      - |-
        run
      - |-
        --kfp
      - |-
        --from-env
      - |-
        --workflow
      - |-
        {{workflow.uid}}
      - |-
        --name
      - |-
        train_model
      - |-
        -p
      - |-
        target=
      - |-
        -i
      - |-
        features={{inputs.parameters.load-data-features}}
      - |-
        -i
      - |-
        labels={{inputs.parameters.load-data-labels}}
      - |-
        -o
      - |-
        model
      - |-
        -o
      - |-
        xtest
      - |-
        -o
      - |-
        ytest
      - |-
        --handler
      - |-
        train
      - |-
        --runtime
      - |-
        {'kind': 'job', 'metadata': {'name': 'step-2---kfp-pipeline'}, 'spec': {'command': '', 'args': [], 'image': 'docker-registry.default-tenant.app.yjb-3.iguazio-cd2.com:80/mlrun/mlrunlgb:latest', 'mode': '', 'volumes': [{'flexVolume': {'driver': 'v3io/fuse', 'options': {'accessKey': '4a5eabdc-0814-489e-9fdf-6ad2fa5df31d', 'container': 'users', 'subPath': '/admin'}}, 'name': 'v3io'}], 'volume_mounts': [{'mountPath': '/User', 'name': 'v3io'}], 'env': [{'name': 'V3IO_API', 'value': 'v3io-webapi.default-tenant.svc:8081'}, {'name': 'V3IO_USERNAME', 'value': 'admin'}, {'name': 'V3IO_ACCESS_KEY', 'value': '4a5eabdc-0814-489e-9fdf-6ad2fa5df31d'}], 'description': '', 'build': {'functionSourceCode': 'IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlciBvbiAyMDE5LTEyLTExIDE0OjI0CgppbXBvcnQgb3MKaW1wb3J0IHBpY2tsZQpmcm9tIGlvIGltcG9ydCBTdHJpbmdJTwpmcm9tIHVybGxpYi5yZXF1ZXN0IGltcG9ydCB1cmxyZXRyaWV2ZQoKaW1wb3J0IG1hdHBsb3RsaWIucHlwbG90IGFzIHBsdApmcm9tIHNrbGVhcm4ubWV0cmljcyBpbXBvcnQgcm9jX2F1Y19zY29yZSwgcm9jX2N1cnZlLCBhY2N1cmFjeV9zY29yZQpmcm9tIHNrbGVhcm4ubW9kZWxfc2VsZWN0aW9uIGltcG9ydCB0cmFpbl90ZXN0X3NwbGl0CmZyb20gc2tsZWFybi5leHRlcm5hbHMgaW1wb3J0IGpvYmxpYgpmcm9tIHNrbGVhcm4ucHJlcHJvY2Vzc2luZyBpbXBvcnQgT25lSG90RW5jb2RlcgoKaW1wb3J0IGxpZ2h0Z2JtIGFzIGxnYgppbXBvcnQgcGFuZGFzIGFzIHBkCmZyb20gbWxydW4uYXJ0aWZhY3RzIGltcG9ydCBDaGFydEFydGlmYWN0LCBUYWJsZUFydGlmYWN0LCBQbG90QXJ0aWZhY3QKCmltcG9ydCB3YXJuaW5ncwp3YXJuaW5ncy5maWx0ZXJ3YXJuaW5ncygnaWdub3JlJykKCmRlZiBfZ2V0X2NvbnRleHRfdGFibGUoY3R4dGFibGUsIGVuY29kaW5nPSd1dGYtOCcpOgogICAgIiIiRXh0cmFjdCBhIHBhbmRhcyBEYXRhRnJhbWUgZnJvbSB0aGUgYGNvbnRleHRgLgogICAgIiIiCiAgICB0YWJsZV9zdHIgPSBTdHJpbmdJTyhzdHIoY3R4dGFibGUuZ2V0KCksIGVuY29kaW5nKSkKICAgIHJldHVybiBwZC5yZWFkX2Nzdih0YWJsZV9zdHIpCgpkZWYgX2dldF9jb250ZXh0X21vZGVsKAogICAgY3R4bW9kZWwsIAogICAgbW9kZWxfdHlwZT1sZ2IuQm9vc3RlciwgCiAgICBlbmNvZGluZz0ndXRmLTgnCik6CiAgICAiIiJEZXNlcmlhbGl6ZSBhIG1vZGVsIGZyb20gdGhlIGBjb250ZXh0YC4KICAgICIiIgogICAgd2l0aCBvcGVuKGYnL1VzZXIvcHJvamVjdHMvaGlnZ3Mve2N0eG1vZGVsfScsICdyYicpIGFzIG1vZGVsX2ZoOiAKICAgICAgICBjbGYyID0gcGlja2xlLmxvYWRzKG1vZGVsX2ZoLnJlYWQoKSkKICAgIHJldHVybiBjbGYyCgpkZWYgX3RyYWluX3ZhbGlkX3Rlc3Rfc3BsaXRzKHgsIHksIHJhbmRzdGF0ZT0xKToKICAgICIiIlNwbGl0cyBkYXRhIGludG8gdHJhaW4sIHZhbGlkYXRpb24gYW5kIHRlc3Qgc2V0cy4KICAgICIiIgogICAgeCwgWHRlc3QsIHksIHl0ZXN0ID0gdHJhaW5fdGVzdF9zcGxpdCh4LCB5LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVzdF9zaXplPTAuMTAsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFpbl9zaXplPTAuOTAsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5kb21fc3RhdGU9cmFuZHN0YXRlKQogICAgCiAgICBYdHJhaW4sIFh2YWxpZCwgeXRyYWluLCB5dmFsaWQgPSB0cmFpbl90ZXN0X3NwbGl0KHgsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVzdF9zaXplID0gMC4yNSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYWluX3NpemUgPTAuNzUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5kb21fc3RhdGU9cmFuZHN0YXRlKQogICAgcmV0dXJuIFh0cmFpbiwgWHZhbGlkLCBYdGVzdCwgeXRyYWluLCB5dmFsaWQsIHl0ZXN0CgpkZWYgbG9hZChjb250ZXh0LAogICAgICAgICB0YXJnZXQ9JycsCiAgICAgICAgIHJhbmRzdGF0ZSA9IDEKKToKICAgICIiIkxvYWQgcmF3IGRhdGEgYXJ0aWZhY3RzLgogICAgIiIiCiAgICAKICAgIGhlYWRlciA9IFsnbGFiZWxzJywgJ2xlcHRvbiBwVCAnLCAnbGVwdG9uIGV0YSAnLCAnbGVwdG9uIHBoaSAnLAogICAgICAgICAgICdtaXNzaW5nIGVuZXJneSBtYWduaXR1ZGUgJywgJ21pc3NpbmcgZW5lcmd5IHBoaSAnLCAnamV0IDEgcHQgJywKICAgICAgICAgICAnamV0IDEgZXRhICcsICdqZXQgMSBwaGkgJywgJ2pldCAxIGItdGFnICcsICdqZXQgMiBwdCAnLAogICAgICAgICAgICdqZXQgMiBldGEgJywgJ2pldCAyIHBoaSAnLCAnamV0IDIgYi10YWcgJywgJ2pldCAzIHB0ICcsCiAgICAgICAgICAgJ2pldCAzIGV0YSAnLCAnamV0IDMgcGhpICcsICdqZXQgMyBiLXRhZyAnLCAnamV0IDQgcHQgJywKICAgICAgICAgICAnamV0IDQgZXRhICcsICdqZXQgNCBwaGkgJywgJ2pldCA0IGItdGFnJywgJ21famonLCAnbV9qamonLAogICAgICAgICAgICdtX2x2ICcsICdtX2psdicsICdtX2JiICcsICdtX3diYiAnLCAnbV93d2JiJ10gICAgCiAgICAKICAgIHJhd19kYXRhID0gcGQucmVhZF9jc3YoJy9Vc2VyL3Byb2plY3RzL2hpZ2dzL2RhdGEvSElHR1MuY3N2JywgbmFtZXM9aGVhZGVyKQogICAgbGFiZWxzID0gcmF3X2RhdGEucG9wKCdsYWJlbHMnKQogICAgCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChUYWJsZUFydGlmYWN0KCdmZWF0dXJlcycsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZj1yYXdfZGF0YSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldF9wYXRoPSdmZWF0dXJlcy5jc3YnKSkKICAgIAogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoVGFibGVBcnRpZmFjdCgnbGFiZWxzJywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRmPXBkLkRhdGFGcmFtZShsYWJlbHMsIGNvbHVtbnM9WydsYWJlbHMnXSksIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfcGF0aD0nbGFiZWxzLmNzdicpKQoKZGVmIHRyYWluKGNvbnRleHQsCiAgICAgICAgICBmZWF0dXJlcywKICAgICAgICAgIGxhYmVscywKICAgICAgICAgIGJvb3N0X3JvdW5kPTYsCiAgICAgICAgICBudW1fbGVhdmVzPTMxLAogICAgICAgICAgbGVhcm5pbmdfcmF0ZT0gMC4xLAogICAgICAgICAgdGFyZ2V0X3BhdGg9JycKICAgICk6CiAgICAiIiJUcmFpbiBhbmQgc2F2ZSB0aGUgbGlnaHRnYm0gbW9kZWwuCiAgICAiIiIKICAgIHJhbmRzdGF0ZSA9IDEKICAgIGxnYmZpdF92ZXJib3NlID0gVHJ1ZQogICAgCiAgICBsZ2JfY2xmID0gbGdiLkxHQk1DbGFzc2lmaWVyKGJvb3N0X3JvdW5kPTYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bV9sZWF2ZXM9MzEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXJuaW5nX3JhdGU9IDAuMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0aXZlPSdiaW5hcnknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRyaWM9J2JpbmFyeV9sb2dsb3NzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZG9tX3N0YXRlPXJhbmRzdGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lsZW50PVRydWUpCgogICAgZmVhdHVyZXMgPSBfZ2V0X2NvbnRleHRfdGFibGUoZmVhdHVyZXMpCiAgICBsYWJlbHMgPSBfZ2V0X2NvbnRleHRfdGFibGUobGFiZWxzKQogICAgCiAgICBYdHJhaW4sIFh2YWxpZCwgWHRlc3QsIHl0cmFpbiwgeXZhbGlkLCB5dGVzdCA9ICAgICAgICAgX3RyYWluX3ZhbGlkX3Rlc3Rfc3BsaXRzKGZlYXR1cmVzLCBsYWJlbHMsIHJhbmRzdGF0ZSkKICAgIAogICAgbGdiX2NsZi5maXQoWHRyYWluLCAKICAgICAgICAgICAgICAgeXRyYWluLAogICAgICAgICAgICAgICBldmFsX3NldD1bKFh2YWxpZCwgeXZhbGlkKSwgKFh0cmFpbiwgeXRyYWluKV0sCiAgICAgICAgICAgICAgIGV2YWxfbmFtZXM9Wyd2YWxpZCcsICd0cmFpbiddLAogICAgICAgICAgICAgICB2ZXJib3NlPWxnYmZpdF92ZXJib3NlKQogICAgCiAgICAKICAgIG1vZGVsX2J5dGVzID0gcGlja2xlLmR1bXBzKGxnYl9jbGYpCiAgICAgICAgICAgICAgICAgCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdCgnbW9kZWwnLCAKICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHk9bW9kZWxfYnl0ZXMsIAogICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3BhdGg9J21vZGVsLnR4dCcsIAogICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxzPXsnZnJhbWV3b3JrJzogJ2xnYm1ib29zdCd9KQogICAgCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChUYWJsZUFydGlmYWN0KCd4dGVzdCcsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZj1YdGVzdCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldF9wYXRoPSd4dGVzdC5jc3YnKSkKICAgIAogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoVGFibGVBcnRpZmFjdCgneXRlc3QnLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGY9cGQuRGF0YUZyYW1lKHl0ZXN0LCBjb2x1bW5zPVsnbGFiZWxzJ10pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfcGF0aD0neXRlc3QuY3N2JykpCgpkZWYgcGxvdF9yb2MoeXRlc3QsIHlwcmVkLCBkZXN0cGF0aCwgZm10PSJwbmciKToKICAgIGZwcl94ZywgdHByX3hnLCBfID0gcm9jX2N1cnZlKHl0ZXN0LCB5cHJlZCkKCiAgICBwbHQucGxvdChbMCwgMV0sIFswLCAxXSwgJ2stLScpCiAgICBwbHQucGxvdChmcHJfeGcsIHRwcl94ZywgbGFiZWw9J3hnYm9vc3QnKQogICAgcGx0LnhsYWJlbCgnRmFsc2UgcG9zaXRpdmUgcmF0ZScpCiAgICBwbHQueWxhYmVsKCdUcnVlIHBvc2l0aXZlIHJhdGUnKQogICAgcGx0LnRpdGxlKCdyb2MgY3VydmUgLSBsaWdodGdibScpCiAgICBwbHQubGVnZW5kKGxvYz0nYmVzdCcpCiAgICBwbHQuc2F2ZWZpZyhkZXN0cGF0aC5yZXBsYWNlKCcuJywnLScpLCBmb3JtYXQ9Zm10KQogICAgZmlnID0gcGx0LmdjZigpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3QoJ3JvYy1jdXJ2ZScsIGJvZHk9ZmlnKSkKCmRlZiB0ZXN0KGNvbnRleHQsIG1vZGVsLCB4dGVzdCwgeXRlc3QsIHRhcmdldD0nJyk6CiAgICAiIiJMb2FkIG1vZGVsIGFuZCBwcmVkaWN0CiAgICAiIiIKICAgIGxnYm1fbW9kZWwgPSBfZ2V0X2NvbnRleHRfbW9kZWwobW9kZWwpCiAgICAKICAgIHh0ZXN0ID0gX2dldF9jb250ZXh0X3RhYmxlKHh0ZXN0KQogICAgeXRlc3QgPSBfZ2V0X2NvbnRleHRfdGFibGUoeXRlc3QpLnZhbHVlcwogICAgIAogICAgeXByZWQgPSBsZ2JtX21vZGVsLnByZWRpY3QoeHRlc3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICBwcmludChmJ2F1Y19zY29yZSB7cm9jX2F1Y19zY29yZSh5dGVzdCwgeXByZWQpOjAuMmZ9JykKICAgIGNvbnRleHQubG9nX3Jlc3VsdCgnYWNjdXJhY3knLCBmbG9hdChhY2N1cmFjeV9zY29yZSh5dGVzdCwgeXByZWQpKSkKCiAgICBkZWYgcGxvdF9yb2MoeXRlc3QsIHlwcmVkLCBkZXN0cGF0aCwgZm10PSJwbmciKToKICAgICAgICBmcHJfeGcsIHRwcl94ZywgXyA9IHJvY19jdXJ2ZSh5dGVzdCwgeXByZWQpCgogICAgICAgIHBsdC5wbG90KFswLCAxXSwgWzAsIDFdLCAnay0tJykKICAgICAgICBwbHQucGxvdChmcHJfeGcsIHRwcl94ZywgbGFiZWw9J3hnYm9vc3QnKQogICAgICAgIHBsdC54bGFiZWwoJ0ZhbHNlIHBvc2l0aXZlIHJhdGUnKQogICAgICAgIHBsdC55bGFiZWwoJ1RydWUgcG9zaXRpdmUgcmF0ZScpCiAgICAgICAgcGx0LnRpdGxlKCdyb2MgY3VydmUgLSBsaWdodGdibScpCiAgICAgICAgcGx0LmxlZ2VuZChsb2M9J2Jlc3QnKQogICAgICAgIHBsdC5zYXZlZmlnKGRlc3RwYXRoLnJlcGxhY2UoJy4nLCctJyksIGZvcm1hdD1mbXQpCiAgICAgICAgZmlnID0gcGx0LmdjZigpCiAgICAgICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoUGxvdEFydGlmYWN0KCdyb2MtY3VydmUnLCBib2R5PWZpZykpCgogICAgcGxvdF9yb2MoeXRlc3QsIAogICAgICAgICAgICAgeXByZWQsIAogICAgICAgICAgICAgJ21vZGVsLnR4dCcsCiAgICAgICAgICAgICBmbXQ9J3BuZycpCgo=', 'image': 'mlrun/mlrunlgb:latest', 'base_image': 'python:3.6-jessie', 'commands': ['pip install -U matplotlib sklearn lightgbm kfp', 'pip install mlrun']}}}
      - ""
      "env":
      - "name": |-
          V3IO_API
        "value": |-
          v3io-webapi.default-tenant.svc:8081
      - "name": |-
          V3IO_USERNAME
        "value": |-
          admin
      - "name": |-
          V3IO_ACCESS_KEY
        "value": |-
          4a5eabdc-0814-489e-9fdf-6ad2fa5df31d
      "image": |-
        mlrun/mlrun:latest
      "volumeMounts":
      - "mountPath": |-
          /User
        "name": |-
          v3io
    "inputs":
      "parameters":
      - "name": |-
          load-data-features
      - "name": |-
          load-data-labels
    "name": |-
      train-model
    "outputs":
      "artifacts":
      - "name": |-
          mlpipeline-ui-metadata
        "path": |-
          /mlpipeline-ui-metadata.json
      - "name": |-
          mlpipeline-metrics
        "path": |-
          /mlpipeline-metrics.json
      - "name": |-
          train-model-model
        "path": |-
          /tmp/model
      - "name": |-
          train-model-xtest
        "path": |-
          /tmp/xtest
      - "name": |-
          train-model-ytest
        "path": |-
          /tmp/ytest
      "parameters":
      - "name": |-
          train-model-model
        "valueFrom":
          "path": |-
            /tmp/model
      - "name": |-
          train-model-xtest
        "valueFrom":
          "path": |-
            /tmp/xtest
      - "name": |-
          train-model-ytest
        "valueFrom":
          "path": |-
            /tmp/ytest
    "volumes":
    - "flexVolume":
        "driver": |-
          v3io/fuse
        "options":
          "accessKey": |-
            4a5eabdc-0814-489e-9fdf-6ad2fa5df31d
          "container": |-
            users
          "subPath": |-
            /admin
      "name": |-
        v3io
